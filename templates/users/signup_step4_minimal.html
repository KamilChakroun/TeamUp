{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Sign Up - Step 4 | TeamUp</title>

    <link rel="shortcut icon" href="{% static 'core/images/favicon.ico' %}" />
    <link rel="stylesheet" href="{% static 'core/css/libs.min.css' %}" />
    <link rel="stylesheet" href="{% static 'core/css/socialv.css' %}" />
    <link
      rel="stylesheet"
      href="{% static 'core/vendor/remixicon/fonts/remixicon.css' %}"
    />
    <style>
      /* Enable scrolling for form content */
      .sign-in-page {
        min-height: 100vh;
        display: flex;
        align-items: center;
      }
      .sign-in-from {
        max-height: calc(100vh - 100px);
        overflow-y: auto;
        padding-right: 15px;
      }
      /* Custom scrollbar */
      .sign-in-from::-webkit-scrollbar {
        width: 6px;
      }
      .sign-in-from::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }
      .sign-in-from::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
      }
      .sign-in-from::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
      .alert-solid {
        color: #fff;
        border: none;
      }
      .alert-solid .btn-close {
        filter: brightness(0) invert(1);
      }
      .alert-solid i {
        font-size: 18px;
        margin-right: 8px;
      }
      /* Availability grid layout */
      .availability-patterns {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-top: 15px;
      }
      
      /* Availability card styling - Modern design */
      .availability-card {
        position: relative;
        border: 2px solid #e3e6ea;
        border-radius: 12px;
        padding: 16px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        background: #fff;
        margin-bottom: 0;
      }
      
      .availability-card:hover {
        border-color: #50b5ff;
        box-shadow: 0 4px 12px rgba(80, 181, 255, 0.2);
        transform: translateY(-2px);
      }
      
      /* Hide default checkbox */
      .availability-card .form-check-input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
      }
      
      /* Custom checkbox design */
      .availability-card .form-check-label {
        cursor: pointer;
        margin-bottom: 0;
        padding-left: 0;
        display: block;
        width: 100%;
        position: relative;
      }
      
      .availability-card .form-check-label::before {
        content: '';
        position: absolute;
        top: 2px;
        right: 2px;
        width: 22px;
        height: 22px;
        border: 2px solid #d1d5db;
        border-radius: 6px;
        background: #fff;
        transition: all 0.3s ease;
      }
      
      .availability-card .form-check-label::after {
        content: 'âœ“';
        position: absolute;
        top: 1px;
        right: 6px;
        font-size: 16px;
        font-weight: bold;
        color: #fff;
        opacity: 0;
        transform: scale(0.3);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      /* Checked state */
      .availability-card input[type="checkbox"]:checked ~ .form-check-label::before {
        background: linear-gradient(135deg, #50b5ff 0%, #3b9bff 100%);
        border-color: #50b5ff;
        box-shadow: 0 2px 8px rgba(80, 181, 255, 0.4);
      }
      
      .availability-card input[type="checkbox"]:checked ~ .form-check-label::after {
        opacity: 1;
        transform: scale(1);
      }
      
      .availability-card input[type="checkbox"]:checked ~ .form-check-label {
        color: #1e40af;
      }
      
      .availability-card input[type="checkbox"]:checked ~ .form-check-label strong {
        color: #50b5ff;
      }
      
      /* Active/Focus state */
      .availability-card input[type="checkbox"]:focus ~ .form-check-label::before {
        box-shadow: 0 0 0 3px rgba(80, 181, 255, 0.2);
      }
      
      /* Card content styling */
      .availability-card strong {
        display: block;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 4px;
        color: #1f2937;
        transition: color 0.3s ease;
      }
      
      .availability-card small {
        display: block;
        font-size: 12px;
        color: #6b7280;
        line-height: 1.4;
      }
      
      .availability-card .ri-time-line {
        display: none;
      }
      
      /* Responsive - Single column on mobile */
      @media (max-width: 768px) {
        .availability-patterns {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body class="">
    <div id="loading">
      <div id="loading-center"></div>
    </div>

    <div class="wrapper">
      <section class="sign-in-page">
        <div id="container-inside">
          <div id="circle-small"></div>
          <div id="circle-medium"></div>
          <div id="circle-large"></div>
          <div id="circle-xlarge"></div>
          <div id="circle-xxlarge"></div>
        </div>
        <div class="container p-0">
          <div class="row no-gutters">
            <div class="col-md-6 text-center pt-5">
              <div class="sign-in-detail text-white">
                <a class="sign-in-logo mb-5" href="/"
                  ><img
                    src="{% static 'core/images/logo-full.png' %}"
                    class="img-fluid"
                    alt="logo"
                /></a>
                <div class="sign-slider overflow-hidden">
                  <ul class="swiper-wrapper list-inline m-0 p-0">
                    <li class="swiper-slide">
                      <img
                        src="{% static 'core/images/login/3.png' %}"
                        class="img-fluid mb-4"
                        alt="logo"
                      />
                      <h4 class="mb-1 text-white">Almost Done!</h4>
                      <p>
                        Tell us when you're available to play and complete your registration.
                      </p>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-md-6 bg-white pt-5 pb-lg-0 pb-5">
              <div class="sign-in-from">
                <h1 class="mb-0">Availability</h1>
                <p>Step 4 of 4 - When can you play?</p>

                <div class="progress mb-3" style="height: 5px">
                  <div
                    class="progress-bar bg-primary"
                    role="progressbar"
                    style="width: 100%"
                  ></div>
                </div>

                {% if error_messages %} {% for error in error_messages %}
                <div
                  class="alert alert-solid alert-danger alert-dismissible fade show mb-3"
                  role="alert"
                >
                  <span><i class="ri-alert-line"></i></span>
                  <span> {{ error }}</span>
                  <button
                    type="button"
                    class="btn-close btn-close-white"
                    data-bs-dismiss="alert"
                    aria-label="Close"
                  ></button>
                </div>
                {% endfor %} {% endif %}

                <form
                  class="mt-4"
                  method="post"
                  action="{% url 'users:signup_step4' %}"
                  id="signupStep4Form"
                  novalidate
                >
                  {% csrf_token %}

                  <div class="form-group">
                    <label class="form-label mb-2"
                      ><strong>When are you available to play?</strong> *</label
                    >
                    <small class="form-text text-muted d-block mb-3"
                      >Select all that apply. This helps us match you with others.</small
                    >
                    
                    <div class="availability-patterns">
                      {% for code, name, description in availability_patterns %}
                      <div class="form-check availability-card">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          name="availability"
                          value="{{ code }}"
                          id="availability_{{ code }}"
                          {% if code in selected_availability %}checked{% endif %}
                        />
                        <label
                          class="form-check-label"
                          for="availability_{{ code }}"
                        >
                          <strong>{{ name }}</strong>
                          <small>{{ description }}</small>
                        </label>
                      </div>
                      {% endfor %}
                    </div>
                    
                    <div class="invalid-feedback d-block" id="availability-error" style="display: none !important;">
                      Please select at least one availability pattern.
                    </div>
                  </div>

                  <div
                    class="alert alert-info d-flex align-items-start mt-4"
                    role="alert"
                  >
                    <i class="ri-information-line me-2 fs-5 mt-1"></i>
                    <div>
                      <strong>Final Step!</strong><br />
                      <small
                        >After submitting, we'll send a verification email to activate your
                        account.</small
                      >
                    </div>
                  </div>

                  <div class="d-inline-block w-100 mt-4">
                    <a
                      href="{% url 'users:signup_step3' %}"
                      class="btn btn-outline-secondary"
                      >Back</a
                    >
                    <button type="submit" class="btn btn-success float-end">
                      <i class="ri-check-line me-1"></i> Create Account
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <script src="{% static 'core/js/libs.min.js' %}"></script>
    <script src="{% static 'core/js/slider.js' %}"></script>
    <script src="{% static 'core/js/app.js' %}"></script>
    <script src="{% static 'core/js/lottie.js' %}"></script>

    <script>
      // Client-side validation for signup step 4
      document
        .getElementById('signupStep4Form')
        .addEventListener('submit', function (e) {
          const checkboxes = document.querySelectorAll('input[name="availability"]:checked');
          const errorDiv = document.getElementById('availability-error');
          let isValid = true;

          // Availability validation - at least one checkbox must be checked
          if (checkboxes.length === 0) {
            e.preventDefault();
            errorDiv.style.display = 'block';
            isValid = false;
          } else {
            errorDiv.style.display = 'none';
          }

          return isValid;
        });

      // Remove error message when a checkbox is clicked
      document.querySelectorAll('input[name="availability"]').forEach(function(checkbox) {
        checkbox.addEventListener('change', function () {
          const checkboxes = document.querySelectorAll('input[name="availability"]:checked');
          const errorDiv = document.getElementById('availability-error');
          if (checkboxes.length > 0) {
            errorDiv.style.display = 'none';
          }
        });
      });
    </script>
  </body>
</html>
